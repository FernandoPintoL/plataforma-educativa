## Plan de ImplementaciÃ³n: Flujo Multi-Paso para CreaciÃ³n de Tareas/Evaluaciones con IA

### ğŸ“‹ Resumen
Implementar un flujo step-by-step mejorado para la creaciÃ³n de tareas y evaluaciones, donde:
1. Usuario selecciona modo (IA o Manual)
2. Ingresa tÃ­tulo y curso (mÃ­nimo necesario)
3. Agente analiza y sugiere datos (incluyendo tiempo estimado)
4. Usuario revisa anÃ¡lisis (editable) con cÃ¡lculo automÃ¡tico de fecha de entrega
5. Formulario completo pre-llenado con datos analizados
6. PublicaciÃ³n final

### ğŸ¯ Componentes a Crear

#### 1. **TareaWizard.vue** (Componente Principal)
   - Estado global del wizard
   - Manejo de pasos (1-5)
   - Validaciones entre pasos
   - Persistencia de datos
   - UbicaciÃ³n: `/resources/js/pages/Tareas/TareaWizard.vue`

#### 2. **Steps/StepSelector.vue** (Paso 1)
   - Selector visual IA/Manual
   - Cards con iconos y descripciones
   - Almacena selecciÃ³n en estado global
   - UbicaciÃ³n: `/resources/js/pages/Tareas/Steps/StepSelector.vue`

#### 3. **Steps/StepBasicInfo.vue** (Paso 2)
   - Input: TÃ­tulo (required, 5-255 caracteres)
   - Select: Curso (del dropdown de cursos del profesor)
   - BotÃ³n: "Enviar a AnÃ¡lisis" (si IA) o "Siguiente" (si Manual)
   - UbicaciÃ³n: `/resources/js/pages/Tareas/Steps/StepBasicInfo.vue`

#### 4. **Steps/StepAnalysis.vue** (Paso 3)
   - Loading state mientras se analiza
   - Mostrar resultados del anÃ¡lisis en paneles:
     - DescripciÃ³n sugerida
     - Instrucciones sugeridas
     - Tiempo estimado (IMPORTANTE)
     - Dificultad propuesta
     - PuntuaciÃ³n sugerida
     - Cualquier otra informaciÃ³n
   - BotÃ³n: "RevisiÃ³n & ConfirmaciÃ³n"
   - UbicaciÃ³n: `/resources/js/pages/Tareas/Steps/StepAnalysis.vue`

#### 5. **Steps/StepReview.vue** (Paso 4)
   - Mostrar anÃ¡lisis con campos editables:
     - DescripciÃ³n âœï¸
     - Instrucciones âœï¸
     - Tiempo estimado âœï¸
     - Dificultad âœï¸
     - **Campo calculado (read-only inicialmente):** Fecha de Entrega = HOY + tiempo_estimado
     - PuntuaciÃ³n âœï¸ (default 100)
   - BotÃ³n: "Aceptar y Continuar" â†’ abre formulario completo
   - UbicaciÃ³n: `/resources/js/pages/Tareas/Steps/StepReview.vue`

#### 6. **Steps/StepFullForm.vue** (Paso 5)
   - Formulario completo con campos pre-llenados:
     - TÃ­tulo
     - DescripciÃ³n
     - Curso
     - Instrucciones
     - Fecha de Entrega (EDITABLE)
     - PuntuaciÃ³n (EDITABLE)
     - Permite archivos (checkbox)
     - MÃ¡ximo archivos
     - Tipos de archivo permitido
     - Recursos adjuntos (upload)
   - BotÃ³n: "Guardar como Borrador" y "Publicar Tarea"
   - UbicaciÃ³n: `/resources/js/pages/Tareas/Steps/StepFullForm.vue`

#### 7. **Utils/dateCalculator.js**
   - FunciÃ³n: calcularFechaEntrega(tiempoEstimado, unidad)
     - tiempoEstimado: nÃºmero
     - unidad: 'horas', 'dias', 'semanas'
     - Retorna: Date object de fecha futura
   - UbicaciÃ³n: `/resources/js/utils/dateCalculator.js`

### ğŸ”„ Flujo de Datos

```
TareaWizard (Estado Global)
â”œâ”€â”€ selectedMode: 'ia' | 'manual'
â”œâ”€â”€ basicInfo: { titulo, curso_id }
â”œâ”€â”€ analysis: {
â”‚   descripcion,
â”‚   instrucciones,
â”‚   tiempo_estimado,
â”‚   unidad_tiempo,  // 'horas', 'dias', 'semanas'
â”‚   dificultad,
â”‚   puntuacion_sugerida,
â”‚   ...otros campos
â”‚ }
â”œâ”€â”€ review: {
â”‚   descripcion,
â”‚   instrucciones,
â”‚   tiempo_estimado,
â”‚   dificultad,
â”‚   fecha_entrega,  // calculada
â”‚   puntuacion,
â”‚ }
â”œâ”€â”€ form: { ...todos los datos } // pre-llenado
â””â”€â”€ currentStep: 1-5
```

### ğŸ”§ Cambios en el Backend

#### 1. **TareaController.php**
   - Modificar `create()` para renderizar TareaWizard en lugar de form tradicional
   - Mantener `store()` igual (recibe los mismos datos)
   - Cambio: lÃ­nea 90

#### 2. **Validar estructura de respuesta del agente**
   - Asegurarse que include: tiempo_estimado, unidad_tiempo
   - Si no estÃ¡ disponible, agregar lÃ³gica para inferirlo
   - En ContentAnalysisController o crear helper

#### 3. **Nueva ruta (opcional pero recomendada)**
   - POST `/api/tareas/draft` - guardar como borrador en Paso 5
   - Mantener POST `/tareas` para guardar completo

### ğŸ“ Manejo de Estados y Errores

1. **Loading en Paso 3:**
   - Spinner/skeleton mientras se espera anÃ¡lisis
   - Timeout: mostrar mensaje "Reintenta"

2. **Error en AnÃ¡lisis:**
   - BotÃ³n "Reintentar"
   - OpciÃ³n de ir Manual si falla 2 veces

3. **ValidaciÃ³n entre pasos:**
   - Paso 2: Validar tÃ­tulo (5-255 chars) y curso seleccionado
   - Paso 3: Validar que agente respondiÃ³ correctamente
   - Paso 4: Validar que fecha_entrega es futura
   - Paso 5: Usar validaciÃ³n existente del TareaRequest

4. **NavegaciÃ³n atrÃ¡s:**
   - Permitir en todos los pasos
   - Mantener datos ingresados
   - Reanalizar si vuelve a Paso 2 en modo IA

### ğŸ¨ UI/UX Detalles

1. **Indicador de progreso:**
   - NÃºmeros de pasos (1/5, 2/5, etc.)
   - Progreso bar
   - Paso actual destacado

2. **Transiciones:**
   - Slide/fade entre pasos
   - ValidaciÃ³n antes de avanzar (mostrar errores)

3. **Responsividad:**
   - Mobile-first (componentes ocupan todo el ancho)
   - Cards adaptables

### ğŸ§ª Casos de Prueba

1. **Flujo IA Completo:** Selector â†’ TÃ­tulo/Curso â†’ AnÃ¡lisis OK â†’ RevisiÃ³n â†’ Formulario â†’ Publicar
2. **Flujo Manual:** Selector â†’ (salta AnÃ¡lisis) â†’ Formulario completo â†’ Publicar
3. **Error en AnÃ¡lisis:** Paso 3 falla â†’ Reintentar â†’ OK
4. **Ediciones en RevisiÃ³n:** Cambiar tiempo estimado â†’ Fecha auto-actualiza
5. **NavegaciÃ³n atrÃ¡s:** En cualquier paso, volver â†’ Datos persisten
6. **Guardar borrador:** Paso 5 â†’ Guardar como borrador â†’ Recuperable despuÃ©s

### ğŸ“¦ Archivo de ConfiguraciÃ³n (JSON)

```json
{
  "wizard": {
    "steps": 5,
    "allowBackNavigation": true,
    "persistData": true,
    "timeoutSeconds": 15
  },
  "defaults": {
    "puntuacion": 100,
    "permite_archivos": true,
    "max_archivos": 5
  }
}
```

### âš ï¸ Consideraciones Importantes

1. **Compatibilidad Backend:** TareaController.store() debe recibir los MISMOS datos que antes
2. **Backward Compatibility:** Formulario tradicional debe seguir siendo accesible (opciÃ³n "Crear Manual")
3. **Token CSRF:** Mantener protecciÃ³n en POST requests
4. **AutenticaciÃ³n:** Verificar que usuario sea profesor en cada paso
5. **Permisos:** Solo acceso a cursos propios del profesor

### ğŸ“Š Respuesta Esperada del Agente

Se asume que `ContentAnalysisController` retorna algo como:
```json
{
  "success": true,
  "analysis": {
    "titulo": "...",
    "descripcion": "...",
    "instrucciones": "...",
    "tiempo_estimado": 3,
    "unidad_tiempo": "dias",
    "dificultad": "intermedia",
    "puntuacion_sugerida": 100,
    "confidence": 0.85
  }
}
```

Si no incluye tiempo_estimado, ver con el equipo de IA quÃ© lÃ³gica seguir.

---

## âœ… ValidaciÃ³n del Plan

- Â¿El flujo es claro y lineal? âœ“
- Â¿Los datos fluyen correctamente entre componentes? âœ“
- Â¿Se mantiene compatibilidad con backend? âœ“
- Â¿Buen UX con carga mÃ­nima por paso? âœ“
- Â¿Manejo robusto de errores? âœ“
